<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Delete Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Add Product</h2>
        <button onclick="addTestProduct()">Add Test Product</button>
        <div id="add-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: List Products</h2>
        <button onclick="listProducts()">List Products</button>
        <div id="list-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Delete Product</h2>
        <input type="text" id="barkod-to-delete" placeholder="Barkod to delete" value="TEST123">
        <button onclick="deleteProduct()">Delete Product</button>
        <div id="delete-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: Verify Deletion</h2>
        <button onclick="verifyDeletion()">Verify Deletion</button>
        <div id="verify-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        
        async function addTestProduct() {
            const resultDiv = document.getElementById('add-result');
            try {
                const response = await fetch(`${API_BASE}/urunler`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        stokListesi: {
                            'TEST123': {
                                barkod: 'TEST123',
                                ad: 'Test Product for Delete',
                                miktar: 10,
                                alisFiyati: 50,
                                satisFiyati: 100,
                                kategori: 'Test',
                                aciklama: 'Test product for deletion'
                            }
                        }
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Product added successfully</div>';
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to add product: ${result.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function listProducts() {
            const resultDiv = document.getElementById('list-result');
            try {
                const response = await fetch(`${API_BASE}/urunler`);
                const result = await response.json();
                
                if (result.success) {
                    const products = result.data;
                    const productList = Object.keys(products).map(key => {
                        const product = products[key];
                        return `${product.barkod}: ${product.ad} (${product.miktar} units)`;
                    }).join('<br>');
                    
                    resultDiv.innerHTML = `<div class="info">üì¶ Products:<br>${productList || 'No products found'}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to list products: ${result.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function deleteProduct() {
            const resultDiv = document.getElementById('delete-result');
            const barkod = document.getElementById('barkod-to-delete').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/stok-sil/${encodeURIComponent(barkod)}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (result.success) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Product deleted successfully</div>';
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to delete product: ${result.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function verifyDeletion() {
            const resultDiv = document.getElementById('verify-result');
            try {
                const response = await fetch(`${API_BASE}/urunler`);
                const result = await response.json();
                
                if (result.success) {
                    const products = result.data;
                    const testProduct = products['TEST123'];
                    
                    if (!testProduct) {
                        resultDiv.innerHTML = '<div class="success">‚úÖ Product successfully deleted (not found in list)</div>';
                    } else {
                        resultDiv.innerHTML = `<div class="error">‚ùå Product still exists: ${testProduct.ad}</div>`;
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Failed to verify: ${result.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>